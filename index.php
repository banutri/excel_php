<?php

include "vendor/autoload.php";

$dj = '[{
    "NO": 1,
    "NMK": "Parrot, hawk-headed",
    "BAG": "Books",
    "LEM_AW": "3:57",
    "LEM_AK": "2:13",
    "NO_ORDER": "CA-C2-81-A2-A3-A1",
    "KET": "13-090 - Radiation Protection"
  }, {
    "NO": 2,
    "NMK": "Eurasian badger",
    "BAG": "Beauty",
    "LEM_AW": "10:03",
    "LEM_AK": "2:57",
    "NO_ORDER": "40-86-6B-F5-16-85",
    "KET": "3-310 - Expansion Joints"
  }, {
    "NO": 3,
    "NMK": "Bat, madagascar fruit",
    "BAG": "Books",
    "LEM_AW": "15:09",
    "LEM_AK": "23:26",
    "NO_ORDER": "5F-CF-FF-4F-00-A8",
    "KET": "1-002 - Instructions"
  }, {
    "NO": 4,
    "NMK": "Jackrabbit, white-tailed",
    "BAG": "Sports",
    "LEM_AW": "20:01",
    "LEM_AK": "22:15",
    "NO_ORDER": "8D-55-9A-83-70-95",
    "KET": "11-680 - Office Equipment"
  }, {
    "NO": 5,
    "NMK": "Salmon pink bird eater tarantula",
    "BAG": "Computers",
    "LEM_AW": "16:39",
    "LEM_AK": "10:36",
    "NO_ORDER": "48-C6-6F-44-76-B0",
    "KET": "1-518 - Temporary Water"
  }, {
    "NO": 6,
    "NMK": "Lemming, collared",
    "BAG": "Outdoors",
    "LEM_AW": "21:22",
    "LEM_AK": "6:22",
    "NO_ORDER": "0F-5A-70-0F-A9-E2",
    "KET": "11-450 - Residential Equipment"
  }, {
    "NO": 7,
    "NMK": "Stork, greater adjutant",
    "BAG": "Toys",
    "LEM_AW": "19:55",
    "LEM_AK": "23:10",
    "NO_ORDER": "F2-71-03-DA-5A-5B",
    "KET": "2-317 - Select Borrow"
  }, {
    "NO": 8,
    "NMK": "Kookaburra, laughing",
    "BAG": "Electronics",
    "LEM_AW": "13:40",
    "LEM_AK": "17:18",
    "NO_ORDER": "C6-5B-4A-CB-86-9E",
    "KET": "11-090 - Checkroom Equipment"
  }, {
    "NO": 9,
    "NMK": "Mississippi alligator",
    "BAG": "Books",
    "LEM_AW": "5:58",
    "LEM_AK": "4:35",
    "NO_ORDER": "6B-4E-00-0F-69-01",
    "KET": "16-300 - Transmission and Distribution"
  }, {
    "NO": 10,
    "NMK": "Stork, openbill",
    "BAG": "Sports",
    "LEM_AW": "22:53",
    "LEM_AK": "19:40",
    "NO_ORDER": "F9-EF-0F-A1-C9-E0",
    "KET": "8-100 - Doors"
  }, {
    "NO": 11,
    "NMK": "Camel, dromedary",
    "BAG": "Outdoors",
    "LEM_AW": "16:10",
    "LEM_AK": "17:08",
    "NO_ORDER": "34-F6-59-6E-CA-81",
    "KET": "11-850 - Navigation Equipment"
  }, {
    "NO": 12,
    "NMK": "Rufous tree pie",
    "BAG": "Jewelry",
    "LEM_AW": "10:42",
    "LEM_AK": "11:00",
    "NO_ORDER": "7F-17-F3-80-57-EC",
    "KET": "14-200 - Elevators"
  }, {
    "NO": 13,
    "NMK": "Monster, gila",
    "BAG": "Health",
    "LEM_AW": "3:19",
    "LEM_AK": "12:55",
    "NO_ORDER": "4D-B1-BE-EC-AB-17",
    "KET": "13 - Special Construction"
  }, {
    "NO": 14,
    "NMK": "Painted stork",
    "BAG": "Electronics",
    "LEM_AW": "18:14",
    "LEM_AK": "14:48",
    "NO_ORDER": "E8-A7-A9-78-21-60",
    "KET": "2-781 - Asphalt Pavers"
  }, {
    "NO": 15,
    "NMK": "Western lowland gorilla",
    "BAG": "Health",
    "LEM_AW": "14:31",
    "LEM_AK": "17:11",
    "NO_ORDER": "39-C8-C9-0C-D2-CA",
    "KET": "11-060 - Theater and Stage Equipment"
  }, {
    "NO": 16,
    "NMK": "Giant otter",
    "BAG": "Health",
    "LEM_AW": "8:51",
    "LEM_AK": "23:07",
    "NO_ORDER": "39-4D-B3-A7-32-0A",
    "KET": "2-825 - Wood Fences and Gates"
  }, {
    "NO": 17,
    "NMK": "Currasow (unidentified)",
    "BAG": "Health",
    "LEM_AW": "1:22",
    "LEM_AK": "18:50",
    "NO_ORDER": "37-85-DA-F5-ED-D1",
    "KET": "2-621 - Foundatation Drainage Piping"
  }, {
    "NO": 18,
    "NMK": "Coqui partridge",
    "BAG": "Books",
    "LEM_AW": "19:15",
    "LEM_AK": "19:31",
    "NO_ORDER": "FF-58-D8-D4-1A-BB",
    "KET": "13-110 - Cathodic Protection"
  }, {
    "NO": 19,
    "NMK": "Cockatoo, long-billed",
    "BAG": "Beauty",
    "LEM_AW": "9:12",
    "LEM_AK": "17:12",
    "NO_ORDER": "FD-01-15-3B-30-4B",
    "KET": "14-600 - Hoists and Cables"
  }, {
    "NO": 20,
    "NMK": "Possum, common brushtail",
    "BAG": "Games",
    "LEM_AW": "19:34",
    "LEM_AK": "12:44",
    "NO_ORDER": "F5-09-89-D6-B3-D6",
    "KET": "2-900 - Landscaping"
  }, {
    "NO": 21,
    "NMK": "Red-billed buffalo weaver",
    "BAG": "Baby",
    "LEM_AW": "5:56",
    "LEM_AK": "13:09",
    "NO_ORDER": "7F-6E-E5-8A-CD-18",
    "KET": "11-060 - Theater and Stage Equipment"
  }, {
    "NO": 22,
    "NMK": "Mourning collared dove",
    "BAG": "Books",
    "LEM_AW": "8:41",
    "LEM_AK": "17:18",
    "NO_ORDER": "FF-AC-32-6D-7F-43",
    "KET": "2-250 - Shoring and Underpinning"
  }, {
    "NO": 23,
    "NMK": "Roseat flamingo",
    "BAG": "Kids",
    "LEM_AW": "22:52",
    "LEM_AK": "4:32",
    "NO_ORDER": "D2-D8-DA-66-EB-B5",
    "KET": "3-310 - Expansion Joints"
  }, {
    "NO": 24,
    "NMK": "Mudskipper (unidentified)",
    "BAG": "Garden",
    "LEM_AW": "6:27",
    "LEM_AK": "3:15",
    "NO_ORDER": "B3-87-1D-62-CA-9D",
    "KET": "10-150 - Compartments and Cubicles"
  }, {
    "NO": 25,
    "NMK": "Green-winged macaw",
    "BAG": "Grocery",
    "LEM_AW": "10:29",
    "LEM_AK": "15:40",
    "NO_ORDER": "1A-49-48-6E-0F-69",
    "KET": "5-700 - Ornamental Metal"
  }, {
    "NO": 26,
    "NMK": "Kafue flats lechwe",
    "BAG": "Home",
    "LEM_AW": "13:18",
    "LEM_AK": "23:22",
    "NO_ORDER": "9F-1F-C8-1B-77-C6",
    "KET": "11-480 - Athletic, Recreational, and Therapeutic Equipment"
  }, {
    "NO": 27,
    "NMK": "Western patch-nosed snake",
    "BAG": "Grocery",
    "LEM_AW": "22:14",
    "LEM_AK": "15:02",
    "NO_ORDER": "5D-07-02-7E-BC-10",
    "KET": "2-812 - Drip Irrigation"
  }, {
    "NO": 28,
    "NMK": "Goldeneye, common",
    "BAG": "Sports",
    "LEM_AW": "17:55",
    "LEM_AK": "4:09",
    "NO_ORDER": "C3-96-AD-CB-84-EE",
    "KET": "7-100 - Damproofing and Waterproofing"
  }, {
    "NO": 29,
    "NMK": "Moose",
    "BAG": "Toys",
    "LEM_AW": "19:34",
    "LEM_AK": "5:36",
    "NO_ORDER": "97-0A-6A-1D-A4-5F",
    "KET": "9-900 - Paints and Coatings"
  }, {
    "NO": 30,
    "NMK": "Pampa gray fox",
    "BAG": "Shoes",
    "LEM_AW": "22:43",
    "LEM_AK": "20:29",
    "NO_ORDER": "2C-FA-EE-98-BC-13",
    "KET": "11-200 - Water Supply and Treatment Equipment"
  }]
';
$dj = json_decode($dj,true);

$reader = new \PhpOffice\PhpSpreadsheet\Reader\Xls();
// $spreadsheet = IOFactory::createReader(FCPATH.'files/template.xls');
$spreadsheet = $reader->load('template.xls');
$spreadsheet->getActiveSheet()->getPageSetup()
    ->setOrientation(\PhpOffice\PhpSpreadsheet\Worksheet\PageSetup::ORIENTATION_PORTRAIT);
$spreadsheet->getActiveSheet()->getPageSetup()
    ->setPaperSize(\PhpOffice\PhpSpreadsheet\Worksheet\PageSetup::PAPERSIZE_A4);
$spreadsheet->getActiveSheet()->getPageSetup()->setFitToWidth(1);

$spreadsheet->getActiveSheet()->getPageMargins()->setTop(1);
$spreadsheet->getActiveSheet()->getPageMargins()->setRight(0.75);
$spreadsheet->getActiveSheet()->getPageMargins()->setLeft(0.75);
$spreadsheet->getActiveSheet()->getPageMargins()->setBottom(1);

$spreadsheet->getActiveSheet()->getHeaderFooter()
    ->setOddFooter('&L&B' . $spreadsheet->getProperties()->getTitle() . '&RPage &P of &N');

$worksheet = $spreadsheet->getActiveSheet();

$setLogo = new \PhpOffice\PhpSpreadsheet\Worksheet\Drawing();
$setLogo->setName('Logo');
$setLogo->setDescription('Logo');
$setLogo->setPath('logo_pura.png');
$setLogo->setOffsetX(60);
$setLogo->setOffsetY(10);
$setLogo->setHeight(46);
$setLogo->setCoordinates('A1');
$setLogo->setWorksheet($spreadsheet->getActiveSheet());

        
$row = 8;
$worksheet->insertNewRowBefore(9,count($dj));
foreach($dj as $d){
    $worksheet->setCellValue('A'.$row, $d['NO']);
    $worksheet->setCellValue('B'.$row, $d['NMK']);
    $worksheet->setCellValue('C'.$row, $d['BAG']);
    $worksheet->setCellValue('D'.$row, $d['LEM_AW']);
    $worksheet->setCellValue('E'.$row, $d['LEM_AK']);
    $worksheet->setCellValue('F'.$row, $d['NO_ORDER']);
    $spreadsheet->getActiveSheet()->mergeCells('F'.$row.':G'.$row);
    $worksheet->setCellValue('H'.$row, $d['KET']);
    $spreadsheet->getActiveSheet()->mergeCells('H'.$row.':J'.$row);

    $row++;
}
$spreadsheet->getActiveSheet()->removeRow($row); // delete last row template
$last =  $worksheet->getHighestRow();

// ttd
$setTtd1 = new \PhpOffice\PhpSpreadsheet\Worksheet\Drawing();
$setTtd1->setName('Ttd1');
$setTtd1->setDescription('ttd1');
$setTtd1->setPath('ttd/g-anemo.png');
$setTtd1->setOffsetX(40);
$setTtd1->setOffsetY(10);
$setTtd1->setHeight(56);
$setTtd1->setCoordinates('B'.$last-4);
$setTtd1->setWorksheet($spreadsheet->getActiveSheet());

$setTtd2 = new \PhpOffice\PhpSpreadsheet\Worksheet\Drawing();
$setTtd2->setName('Ttd1');
$setTtd2->setDescription('ttd1');
$setTtd2->setPath('ttd/g-cryo.png');
$setTtd2->setOffsetX(45);
$setTtd2->setOffsetY(10);
$setTtd2->setHeight(56);
$setTtd2->setCoordinates('C'.$last-4);
$setTtd2->setWorksheet($spreadsheet->getActiveSheet());

$setTtd3 = new \PhpOffice\PhpSpreadsheet\Worksheet\Drawing();
$setTtd3->setName('Ttd1');
$setTtd3->setDescription('ttd1');
$setTtd3->setPath('ttd/g-hydro.png');
$setTtd3->setOffsetX(25);
$setTtd3->setOffsetY(10);
$setTtd3->setHeight(56);
$setTtd3->setCoordinates('E'.$last-4);
$setTtd3->setWorksheet($spreadsheet->getActiveSheet());

$setTtd3 = new \PhpOffice\PhpSpreadsheet\Worksheet\Drawing();
$setTtd3->setName('Ttd1');
$setTtd3->setDescription('ttd1');
$setTtd3->setPath('ttd/g-dendro.png');
$setTtd3->setOffsetX(55);
$setTtd3->setOffsetY(10);
$setTtd3->setHeight(56);
$setTtd3->setCoordinates('G'.$last-4);
$setTtd3->setWorksheet($spreadsheet->getActiveSheet());

$setTtd3 = new \PhpOffice\PhpSpreadsheet\Worksheet\Drawing();
$setTtd3->setName('Ttd1');
$setTtd3->setDescription('ttd1');
$setTtd3->setPath('ttd/g-geo.png');
$setTtd3->setOffsetX(40);
$setTtd3->setOffsetY(10);
$setTtd3->setHeight(56);
$setTtd3->setCoordinates('I'.$last-4);
$setTtd3->setWorksheet($spreadsheet->getActiveSheet());



$last =  $worksheet->getHighestRow();
$worksheet->insertNewRowBefore($last+1,1);
$worksheet->setCellValue('A'.$last, date('d-m-Y'));

$writer = \PhpOffice\PhpSpreadsheet\IOFactory::createWriter($spreadsheet, 'Dompdf');
$writer->save('jajal.pdf');




?>